(()=>{"use strict";function e(){this.status="",this.messageContent="",this.setStatus=e=>this.status=e,this.setMessage=e=>this.messageContent=`<div class="close"><i class="message_btn_close btn bx bx-x" ></i></div><div class="message">${e}</div>`,this.getMessage=()=>this.message,this.getMessageElement=()=>{let e=document.createElement("div");return e.setAttribute("class",`modal_message ${this.status}`),e.innerHTML=this.messageContent,e}}function t(e){let t=document.querySelector(".notification_block");t&&t.classList.toggle("hide"),setTimeout((()=>{t&&t.remove()}),setTimeout)}let s={required:function(e){return"object"==typeof e?Object.keys(e).length:Boolean(e)},minLength:function(e,t){return e.length>=t},maxLength:function(e,t){return e.length<=t},isEmail:function(e){let t=new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return Boolean(e.match(t))},isPasswordRepeated:function(e,t){return e===t}};function o(s,o){t(),setTimeout((()=>{let t=s.querySelectorAll(".error_field");t&&Object.keys(t).forEach((e=>{t[e].classList.toggle("error_field")}));let n=Object.keys(o),r=document.createElement("div");r.setAttribute("class","notification_block"),document.body.appendChild(r),n.forEach((t=>{let n,c=new e,i=s.querySelector(`input[name="${t}"]`),a=s.querySelector(`textarea[name="${t}"]`);i&&s.querySelector(`input[name="${t}"]`).classList.toggle("error_field"),a&&s.querySelector(`textarea[name="${t}"]`).classList.toggle("error_field"),n=o[t][0].message?o[t][0].message:o[t][0],c.setMessage(n),c.setStatus("error"),r.appendChild(c.getMessageElement())}))}),500)}function n(){let e=document.querySelector(".post_categories_params"),t={};if(e){let s=e.querySelectorAll("input");Object.keys(s).forEach((e=>{let o=s[e].closest(".category");if(o){let e=o.querySelector("input"),s=e.name;t[s]={},t[s].category_id=e.dataset.categoryId,t[s].is_category_checked=e.checked,t[s].subcategories=[]}})),t&&Object.keys(t).forEach((s=>{let o=e.querySelector(`input[name="${s}"]`),n=e.querySelector(`ul.${s}`);if(n){let e=n.querySelectorAll("input");Object.keys(e).forEach((o=>{let n=e[o];n.checked&&t[s].subcategories.push(n.dataset.subcategoryId)}))}t[s].subcategories.length||o.checked||delete t[s]}))}return t}document.addEventListener("click",(e=>{if(e.target.classList.contains("message_btn_close")){let t=e.target.closest(".modal_message");t.classList.toggle("hide"),setTimeout((()=>{t.remove()}),400)}}));let r=document.querySelector(".comment_form");if(r){let a=r.querySelector("textarea");a.removeAttribute("cols"),a.removeAttribute("rows"),document.querySelector(".leave_comment").addEventListener("click",(function(a){a.preventDefault();let l=function(e,t,r){let c=function(e,t){let s=e.querySelectorAll("input"),o=e.querySelectorAll("textarea"),r=document.querySelector(".post_create_form"),c={};return s&&s.forEach((e=>{let s=e.name;t.includes(s)&&("gender"==s?e.checked&&(c[s]=e.value):c[s]=e.value)})),o&&o.forEach((e=>{if(e.closest(".django-ckeditor-widget")){let t=CKEDITOR.instances[`id_${e.name}`],s=t.getData();if(c[e.name]=s,s.length){let e=200,s=t.document.getBody().getText().trim().slice(0,e),o=t.document.findOne("img");c.preview_image_url=o?o.getAttribute("src"):"",c.preview_text=s}}else c[e.name]=e.value})),r&&Object.assign(c,{post_subcategory:n()}),c}(e,Object.keys(t)),i=function(e,t,o){let n=Object.keys(e),r={};return n.forEach((n=>{t[n].forEach((t=>{let c="object"==typeof t,i=c?Object.keys(t)[0]:t,a=c?s[i]:s[t],l=!0;if(c)"maxLength"!=i&&"minLength"!=i||(l=a(e[n],t[i]));else if("isPasswordRepeated"==i){let t=e.password;t&&(l=a(t,e[n]))}else l=a(e[n]);if(!l){let e=o[n][i];r[n]||(r[n]=[]),e||console.log(`There is no error message for validator '${i}' for '${n}' field`),r[n].push(e)}}))})),r}(c,t,r),a=!Object.keys(i).length,l={isValid:a,formData:""};return a?l.formData=c:o(e,i),l}(r,c,i);if(console.log(l),l.isValid){let s=l.formData;(function(s,n,r,c=null){let i=(l="csrftoken",function(){let e=document.cookie,t={};return e&&""!==e&&(t=e.split(";").map((e=>e.split("="))).reduce(((e,t)=>{let s=t[0].trim(),o=t[1];return e[s]={},e[s]=o,e}),t)),t}()[l]),a={};var l;return a=fetch(`${r}/`,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","X-Requested_with":"XMLHttpRequest","X-CSRFToken":i},body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{if("success"==n.status){if(t(),n.success_message){let t=document.createElement("div"),s=new e;s.setStatus(n.status),s.setMessage(n.success_message),t.setAttribute("class","notification_block"),t.appendChild(s.getMessageElement()),document.body.appendChild(t)}c&&setTimeout((()=>{window.location=c}),500),n.redirect_url&&setTimeout((()=>{window.location=n.redirect_url}),500)}return"error"==n.status&&(console.log(n.errors),console.log(JSON.parse(n.errors)),o(s,JSON.parse(n.errors))),n})).catch((e=>{console.log(e)})),a})(r,s,"update_post_comments").then((e=>{let t=function(e){let t=document.createElement("div");return t.classList.toggle("comment"),t.innerHTML=`<div class="background"></div><div class="details"><a class="author" href="${e.author_url}"><img src="${e.author_avatar_url}" alt=""><div class="name">${e.author_login}</div></a><div class="date">${e.created_at}</div></div><div class="content">${e.content}</div><div class="options"><i class="bx bx-dislike"></i><i class="bx bx-like"></i><i class="bx bx-reply bx-flip-horizontal"></i><i class="bx bx-message-square-detail"></i></div>`,t}(e.new_comment_data),s=document.querySelector(".comment"),o=!!s&&s.parentNode,n=document.querySelector(".comments .total");s?o.insertBefore(t,s):document.querySelector(".post_comments").appendChild(t),document.querySelector("textarea").value="",n.textContent=+n.textContent+1}))}}))}let c={content:["required",{minLength:2},{maxLength:500}]},i={content:{required:"Comment can not be empty.",minLength:"Comment is too short. Minimum length is 2.",maxLength:"Comment is too long. Maximum length is 500."}};document.querySelector(".post").addEventListener("click",(e=>{if(e.target.closest(".content img")){let t=e.target.src;document.body.appendChild(function(e){let t=document.createElement("div");return t.setAttribute("class","image_modal"),t.innerHTML=`<img src="${e}"><div class="background"></div><i class="close btn bx bx-x" ></i>`,t}(t))}})),document.body.addEventListener("click",(e=>{e.target.closest(".image_modal")&&e.target.closest(".image_modal").remove()}))})();